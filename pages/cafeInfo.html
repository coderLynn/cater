<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <title>cafe infomation</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/cafe.css">
</head>
<body>
    <section class="container" ref="scroll">
        <div>
            <div class="cafe-intro-box">
                <div class="img-box">
                    <img v-if="restaurant.imgs" :src="restaurant.imgs[0]" alt="">
                </div>
                <div class="second-box">
                    <h2>{{restaurant.name}}</h2>
                    <p>
                        <span>
                            <span class="star-box">
                                <span v-for="star in restaurant.score" class="icon-star icon-star-active"></span>
                                <span v-for="star in restaurant.leftScore" class="icon-star"></span>
                            </span>
                            <span>¥{{restaurant.avgPrice}}/人</span>
                            <span>月售{{restaurant.scoreCount}}</span>
                        </span>
                    </p>
                </div>
                <div class="address-box">
                    <div>
                        <h3>{{restaurant.address}}</h3>
                        <p>
                            <span>距您{{restaurant.distance}}m</span><span></span>
                        </p>
                    </div>
                    <span class="icon-tell"></span>
                </div>
                <div class="status-box">
                    <span class="open-status">{{restaurant.businessTime}}</span>
                </div>
            </div>
            <div class="cafe-box">
                <div class="tool-bar">
                    <div @click="showPanel(1)" :class="{active:showFood}">点餐</div>
                    <div @click="showPanel(2)" :class="{active:showComment}">评价</div>
                    <div @click="showPanel(3)" :class="{active:showStore}">商家</div>
                </div>
                <div v-show="showFood" class="food-box">
                    <div class="food-box-wrapper">
                        <div class="cat-box" ref="catBox">
                            <ul>
                                <li>热销</li>
                                <li>米饭小吃</li>
                                <li>工作套餐</li>
                                <li>招牌拌菜</li>
                                <li>特色啃卤</li>
                                <li>果汁饮料</li>
                            </ul>
                        </div>
                        <div class="food-wrapper" ref="foodWrapper">
                            <p><span>热销</span>大家喜欢吃的，才叫真好吃</p>
                            <ul>
                                <li @click="_showIntroFood">
                                    <div class="item-img">
                                        <img src="../images/hotel_item.png" alt="">
                                    </div>
                                    <div class="item-content">
                                        <h2>鲁西肥牛2人餐</h2>
                                        <p>月售354</p>
                                        <div>
                                            <p>￥<span class="price">98</span><span>起</span></p>
                                            <div>
                                                <span class="del-btn"></span>
                                                <span class="num">1</span>
                                                <span class="add-btn"></span>
                                            </div>

                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="item-img">
                                        <img src="../images/hotel_item.png" alt="">
                                    </div>
                                    <div class="item-content">
                                        <h2>鲁西肥牛2人餐</h2>
                                        <p>月售354</p>
                                        <div>
                                            <p>￥<span class="price">98</span><span>起</span></p>
                                            <div>
                                                <span class="del-btn"></span>
                                                <span class="num">1</span>
                                                <span class="add-btn"></span>
                                            </div>

                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="item-img">
                                        <img src="../images/hotel_item.png" alt="">
                                    </div>
                                    <div class="item-content">
                                        <h2>鲁西肥牛2人餐</h2>
                                        <p>月售354</p>
                                        <div>
                                            <p>￥<span class="price">98</span><span>起</span></p>
                                            <div>
                                                <span class="del-btn"></span>
                                                <span class="num">1</span>
                                                <span class="add-btn"></span>
                                            </div>

                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="bottom-box">
                        <div>
                            <span class="unchoose">还未选购商品</span>
                        </div>
                        <div>
                            <span>去结算</span>
                        </div>
                    </div>
                </div>
                <div v-show="showComment" class="comment-box">
                    <div>
                        <h3>最新评价</h3>
                        <span>更多评价 (536条)</span>
                    </div>
                    <ul>
                        <li>
                            <div class="user-img">
                                <img src="../images/user-img.png" alt="">
                            </div>
                            <div class="content">
                                <div>
                                    <span class="name">小仙女</span>
                                    <span class="date">2018-07-07发表</span>
                                </div>
                                <p class="score">
                                    <span>打分</span>
                                    <span class="icon-star active"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                </p>
                                <p class="text">2人套餐，两个人简直吃不完，良心推荐，服务员太度也很好，菜品新鲜，颜值口感都好。</p>
                                <span>2人118套餐</span>
                            </div>
                        </li>
                        <li>
                            <div class="user-img">
                                <img src="../images/user-img.png" alt="">
                            </div>
                            <div class="content">
                                <div>
                                    <span class="name">小仙女</span>
                                    <span class="date">2018-07-07发表</span>
                                </div>
                                <p class="score">
                                    <span>打分</span>
                                    <span class="icon-star active"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                </p>
                                <p class="text">2人套餐，两个人简直吃不完，良心推荐，服务员太度也很好，菜品新鲜，颜值口感都好。</p>
                                <span>2人118套餐</span>
                            </div>
                        </li>
                        <li>
                            <div class="user-img">
                                <img src="../images/user-img.png" alt="">
                            </div>
                            <div class="content">
                                <div>
                                    <span class="name">小仙女</span>
                                    <span class="date">2018-07-07发表</span>
                                </div>
                                <p class="score">
                                    <span>打分</span>
                                    <span class="icon-star active"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                </p>
                                <p class="text">2人套餐，两个人简直吃不完，良心推荐，服务员太度也很好，菜品新鲜，颜值口感都好。</p>
                                <span>2人118套餐</span>
                            </div>
                        </li>
                        <li>
                            <div class="user-img">
                                <img src="../images/user-img.png" alt="">
                            </div>
                            <div class="content">
                                <div>
                                    <span class="name">小仙女</span>
                                    <span class="date">2018-07-07发表</span>
                                </div>
                                <p class="score">
                                    <span>打分</span>
                                    <span class="icon-star active"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                    <span class="icon-star"></span>
                                </p>
                                <p class="text">2人套餐，两个人简直吃不完，良心推荐，服务员太度也很好，菜品新鲜，颜值口感都好。</p>
                                <span>2人118套餐</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <div v-show="showStore" ref="showStore" class="store-container">
                    <div class="store-box">
                        <div class="storeInfo">
                            <h2>商家信息</h2>
                            <div class="img-slider" ref="imgScroll">
                                <div ref="sliderGroup">
                                    <div class="img"><img src="../images/hotel_item.png" alt=""></div>
                                    <div class="img"><img src="../images/hotel_item.png" alt=""></div>
                                    <div class="img"><img src="../images/hotel_item.png" alt=""></div>
                                    <div class="img"><img src="../images/hotel_item.png" alt=""></div>
                                </div>
                            </div>
                            <p><span>简介：</span>{{restaurant.introduction}}</p>
                        </div>
                        <div class="cafeService">
                            <h2>餐厅服务</h2>
                            <div>
                                <span>免费停车场</span>
                                <span>无线WIFI</span>
                                <span>卡座</span>
                                <span>沙发位</span>
                                <span>包间</span>
                                <span>刷卡</span>
                            </div>
                            <h2>商家地址</h2>
                            <p>{{restaurant.address}}</p>
                        </div>
                        <div class="storeTel">
                            <h2>商家电话</h2>
                            <p>{{restaurant.tel}}</p>

                        </div>
                        <div  class="storeCertify">
                            <h2>商家资质</h2>
                            <div>
                                <div v-for="(item,index) in restaurant.qualificationsImgs">
                                    <img v-if="index<2" :src="item" alt="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <div class="write-info">
            <ul>
                <li><span>用餐人数</span><input type="text" value="2"></li>
                <li><span>用餐时间</span><input type="text" value="18:00"></li>
                <li><span>联系人</span><input type="text" value=" 张先生"></li>
                <li><span>联系电话</span><input type="text" value="18200378769"></li>
            </ul>
            <div class="chose"><span>选桌</span><span>5号桌</span></div>
            <div class="btn">确认</div>
            <div class="chose-wrapper">
                <div class="chose-box">
                    <div class="name">选桌 <span class="icon-back"></span></div>
                    <ul>
                        <li class="choose">
                            <p>1号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>2号</p>
                        </li>
                        <li>
                            <p>3号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>4号</p>
                        </li>
                        <li>
                            <p>5号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>6号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>7号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>8号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>9号</p>
                            <span>已选</span>
                        </li>
                        <li>
                            <p>10号</p>
                            <span>已选</span>
                        </li>
                    </ul>
                    <div class="btn">完成</div>
                </div>
            </div>
        </div>
        <div @click="_hideIntroFood" v-show="showIntroFood" class="intro-food">
            <div class="intro-food-wrapper">
                <div class="img-box">
                    <img src="../images/hotel_item.png" alt="">
                    <span @click="_hideIntroFood" class="icon-back"></span>
                </div>
                <div class="food-box">
                    <div class="food-des">
                        <h2>鲁西肥牛2人餐</h2>
                        <p>月售538</p>
                        <div>
                            <p>￥<span>98</span></p>
                            <span class="add-btn"></span>
                        </div>
                    </div>
                    <div class="food-list">
                        <h3>商品描述</h3>
                        <p>有锅底3选2（可重复选）</p>
                        <div>
                            <span>清油麻辣（1份）</span>
                            <span>营养三鲜（1份）</span>
                            <span>山珍美容（1份）</span>
                        </div>
                        <p>包含菜品：</p>
                        <div>
                            <span>澳式肥牛（1份）</span>    <span>滋补乌鸡卷（1份）</span>    <span>庄园肥牛（1份）</span>
                            <span>大白菜（1份）</span>    <span>藕片（1份）</span>    <span>红糖糍粑（1份）</span>
                            <span>澳式肥牛（1份）</span>    <span>滋补乌鸡卷（1份）</span>    <span>庄园肥牛（1份）</span>
                            <span>大白菜（1份）</span>    <span>藕片（1份）</span>    <span>红糖糍粑（1份）</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div v-show="showChoseScale" class="chose-scale">
            <div class="chose-scale-wrapper">
                <div class="name-box">
                    <div class="img-box"><img src="../images/hotel_item.png" alt=""></div>
                    <div>
                        <h3>鲁西肥牛2人套餐</h3>
                        <p>已选：<span>清油麻辣</span></p>
                        <p class="price">￥<span>98</span></p>
                    </div>
                    <span @click="_hideChoseScale" class="icon-back"></span>
                </div>
                <div class="scale-box">
                    <div>
                        <p>规格</p>
                        <ul>
                            <li>清油麻辣</li>
                            <li>营养三鲜</li>
                            <li>山珍美容</li>
                        </ul>
                    </div>
                    <div>
                        <p>辣度</p>
                        <ul>
                            <li>微辣</li>
                            <li>中辣</li>
                            <li>特辣</li>
                        </ul>
                    </div>
                </div>
                <div class="btn">选好了</div>
            </div>
        </div>
        </div>
    </section>

    <script src="../js/jquery-1.8.3.min.js"></script>
    <script src="../js/vue.js"></script>
    <script src="../js/bscroll.js"></script>
    <script src="../js/HttpHelper.js"></script>
    <script src="../js/flexble.js"></script>
    <script>
        var index = new Vue({
            el:'.container',
            data:{
                restaurant:{},
                showChoseScale:false,
                showFood:false,
                showStore:true,
                showComment:false,
                showIntroFood:false,
                showStoreY:0,
                scrollY:0,
            },
            props:{
                probeType:{
                    type:Number,
                    default:1
                },
                click:{
                    type:Boolean,
                    default:true
                },
                data:{
                    type:Array,
                    default:null
                },
                listenScroll:{
                    type:Boolean,
                    default:false
                },
                pullup:{
                    type:Boolean,
                    default:false,
                },
                beforeScroll:{
                    type:Boolean,
                    default:false
                },
                refreshDelay:{
                    type:Number,
                    default:20
                }
            },
            created(){
                // var clientHeight = $('.container').height();
                // $('.cafe-box').css({'height':clientHeight});
                this.getRestaurant(2);
            },
            mounted(){
                setTimeout(()=>{
                    this.init_scroll();
                    this._setSliderWidth();
                    this.init_imgScroll();
                },100);
            },
            methods:{
                init_scroll:function () {
                    var _this =this;
                    //初始化外层滚动框
                    if(!this.$refs.scroll){
                        return
                    }
                    this.scroll = new BScroll(this.$refs.scroll,{
                        probeType:this.probeType,
                        click:this.click
                    });

                    //外层滚动 监听滚动位置
                    this.scroll.on('scroll',(pos)=>{
                        _this.scrollY = pos.y;
                        // console.log('外层开始滚动啦'+pos.y);
                        // console.log(_this.scroll.maxScrollY);
                        if(pos.y < _this.scroll.maxScrollY){
                            // _this.showStore.enable();
                            // _this.scroll.scrollTo(0, _this.scroll.maxScrollY);
                            // console.log('开启内部滚动')
                        }else{
                            // _this.showStore.disable();
                        }
                    });

                    //初始化 商家详情 滚动框
                    // if(!this.$refs.showStore){
                    //     return
                    // }
                    // this.showStore = new BScroll(this.$refs.showStore,{
                    //     probeType:this.probeType,
                    //     click:this.click,
                    //     bounce: {
                    //         top: false,
                    //         bottom: false,
                    //         left: false,
                    //         right: false
                    //     }
                    // });
                    //店铺滚动 监听滚动位置
                    // this.showStore.on('scroll',(pos)=>{
                    //     _this.showStoreY = pos.y;
                    //     console.log("内部最大滚动高度"+_this.showStore.maxScrollY);
                    //     console.log("内部滚动"+pos.y);
                    //     if(pos.y>=0){
                    //         _this.scroll.enable();
                    //     }else{
                    //         //禁止外层滚动
                    //         _this.scroll.disable();
                    //         console.log("禁止外层滚动")
                    //
                    //     }
                    // });
                },
                _setSliderWidth(isResize){
                    this.children = this.$refs.sliderGroup.children;
                    let width = 0;
                    let sliderWidth = this.$refs.imgScroll.clientWidth;
                    for(let i = 0;i<this.children.length;i++){
                        let child = this.children[i];
                        // addClass(child,'slider-item');
                        child.style.width = sliderWidth+ 'px';
                        width+=sliderWidth;
                    }
                    if(this.loop&&!isResize){
                        width+=2*sliderWidth;
                        console.log(width)
                    }
                    this.$refs.sliderGroup.style.width = width+ 'px'

                },
                init_imgScroll:function () {
                    if(!this.$refs.imgScroll){
                        return
                    }
                    this.imgscroll = new BScroll(this.$refs.imgScroll,{
                        scrollX:true,
                        scrollY:false,
                        probeType:this.probeType,
                        eventPassthrough:'horizontal',
                        click:this.click
                    })
                },
                //显示 选择规格层
                _showChoseScale:function(){
                    this.showChoseScale = true;
                },
                //隐藏 选择规格层
                _hideChoseScale:function () {
                    this.showChoseScale = false;
                },
                //点菜、评论、店铺 切换显示
                showPanel:function (index) {
                    if(index==1){
                        this.showFood = true;
                        this.showStore = this.showComment =false;
                    }else if(index==2){
                        this.showComment = true;
                        this.showStore = this.showFood =false;
                    }else if(index==3){
                        this.showStore = true;
                        this.showComment = this.showFood =false;
                    }
                },
                //显示 菜品介绍层
                _showIntroFood:function () {
                    this.showIntroFood = true;
                },
                //隐藏 菜品介绍层
                _hideIntroFood:function () {
                    this.showIntroFood = false;
                },


                //获取餐厅信息
                getRestaurant:function (id) {
                    var _this = this;
                    get('/api/Restaurant/GetRestaurant',{'restaurantId':id},function(res){
                        res.leftScore = 5 - res.score;
                        _this.restaurant = res;
                    })
                }
            },
            watch:{
                //外层滚动高度监测

            }
        })
    </script>

</body>
</html>